<!doctype html>
<html lang="cn">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>table</title>

    <!-- Bootstrap core CSS -->
    <link href="../../bootstrap-4.1.1/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <!--<link href="dashboard.css" rel="stylesheet">-->
</head>

<body>
<div class="container-fluid">
    <main role="main" class="col-md-auto ml-sm-auto col-lg-auto px-4" id="contentRoot">
        <h6>表字段</h6>
        <div class="table-responsive pt-3 pb-2 mb-3 border-bottom">
            <table id="tabledesigninfor" class="table table-striped table-sm">
            </table>
        </div>
    </main>
</div>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script>window.jQuery || document.write('<script src="../../../../assets/js/vendor/jquery-slim.min.js"><\/script>')</script>
<script src="../../bootstrap-4.1.1/assets/js/vendor/popper.min.js"></script>
<script src="../../bootstrap-4.1.1/dist/js/bootstrap.min.js"></script>
<script src="js/jquery.url.js"></script>
<script src="js/myutl.js"></script>

<!-- Icons -->
<script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script>
<script>
    var tableName = $.url.param("id")
    var baseUrl = $.url.param("url")
    var tabledesign;
    var currpageIndex = 0;

    $("#contentRoot2").hide();

    function iscachkey(key) {
        for (var k in tabledesign.cacheKey) {
            if (key == tabledesign.cacheKey[k]) {
                return true;
            }
        }
        return false;
    }

    function isprimarykey(key) {
        for (var k in tabledesign.primaryKey) {
            if (key == tabledesign.primaryKey[k]) {
                return true;
            }
        }
        return false;
    }

    function isgroupkey(key) {
        if (key == tabledesign.groupKey) {
            return true;
        }
        return false;
    }

    function getTableInfor() {
        var params = {cmd: "getTableDesign", tableName: tableName, uid: "000"};
        myutl.ajaxJSONP(baseUrl, params,
            function (result, status, xhr) {
                tabledesign = result;
                var tabledesigninfor = $("#tabledesigninfor");
                tabledesigninfor.empty();

                $("#tabledesigninfor").append("<thead>");
                var tr = "<tr >";
                tr = tr + "<th >操作</td>";
                tr = tr + "<th >字段ID</td>";
                tr = tr + "<th >字段类型</td>";
                tr = tr + "<th >主键</td>";
                tr = tr + "<th >缓存键</td>";
                tr = tr + "<th >组主键</td>";
                tr = tr + "<th >字段说明</td>";
                tr = tr + "</tr>";
                tabledesigninfor.append(tr);
                $("#tabledesigninfor").append("</thead>");

                $("#tabledesigninfor").append("<tbody>");

                ///////////////////////////////////////
                tr = "<tr>";
                tr = tr + "<td ><i class='text-success' data-feather=\"plus-circle\"></i></td>";
                tr = tr + "<td ><input type='text' class='col-12'></td>";
                tr = tr + "<td ><input type='text' ></td>";
                tr = tr + "<td ><input type='checkbox' ></td>";
                tr = tr + "<td ><input type='checkbox' ></td>";
                tr = tr + "<td ><input id='new-groupkey' name='options-groupkey' autocomplete=\"off\" type='radio' ></td>";
                tr = tr + "<td ><input type='text' ></td>";
                tr = tr + "</tr>";
                $("#tabledesigninfor").append(tr);
                ///////////////////////////////////////
                var columnsmap = {};
                for (var k in tabledesign.columns) {
                    var d = tabledesign.columns[k];
                    columnsmap[d[0]] = d
                    tr = "<tr>";
                    tr = tr + "<td ><i class='text-danger' data-feather=\"x-circle\"></i></td>";
                    tr = tr + "<td >" + d[0] + "</td>";
                    tr = tr + "<td ><input value='" + d[1] + "'></td>";
                    tr = tr + "<td ><input type='checkbox' " + (isprimarykey(d[0]) ? "checked" : "") + "></td>";
                    tr = tr + "<td ><input type='checkbox' " + (iscachkey(d[0]) ? "checked" : "") + "></td>";
                    tr = tr + "<td ><input id='" + k + "'  name='options-groupkey' " + (isgroupkey(d[0]) ? "checked" : "") + " autocomplete=\"off\" type='radio'></td>";
                    tr = tr + "<td ><input value='" + d[2] + "'></td>";
                    tr = tr + "</tr>";
                    $("#tabledesigninfor").append(tr);
                }
                $("#tabledesigninfor").append("</tbody>");
                tabledesign.columnsmap = columnsmap;

                feather.replace();
            },
            function (jqXHR, textStatus, errorThrown) {
                alert("取得信息失败！");
            });
    }

    function init() {
        getTableInfor();
        feather.replace();
    }

    $(document).ready(init)
</script>

</body>
</html>
